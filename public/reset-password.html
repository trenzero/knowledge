<!DOCTYPE html>
<html>
<head>
    <title>密码重置工具</title>
    <style>
        body { font-family: system-ui; background: #1a1a1a; color: white; padding: 2rem; }
        .container { max-width: 500px; margin: 0 auto; }
        .card { background: #2d2d2d; padding: 2rem; border-radius: 0.5rem; border: 1px solid #404040; }
        input, button { width: 100%; padding: 0.75rem; margin: 0.5rem 0; border-radius: 0.5rem; border: 1px solid #404040; }
        input { background: #1a1a1a; color: white; }
        button { background: #4f46e5; color: white; border: none; cursor: pointer; }
        button:hover { background: #4338ca; }
        .success { color: #10b981; }
        .error { color: #ef4444; }
    </style>
</head>
<body>
    <div class="container">
        <div class="card">
            <h2>密码重置工具</h2>
            <p>这个工具可以帮助你重置KV命名空间中的会话数据。</p>
            
            <div>
                <h3>方法1: 清除所有会话</h3>
                <button onclick="clearAllSessions()">清除所有会话</button>
            </div>
            
            <div style="margin-top: 2rem;">
                <h3>方法2: 设置新密码</h3>
                <p>在Cloudflare Pages设置中更新PASSWORD环境变量：</p>
                <ol>
                    <li>进入Cloudflare Dashboard → Workers & Pages → 你的项目</li>
                    <li>进入 Settings → Environment Variables</li>
                    <li>更新 PASSWORD 变量的值</li>
                    <li>重新部署应用</li>
                </ol>
            </div>
            
            <div id="results" style="margin-top: 1rem;"></div>
        </div>
    </div>

    <script>
        async function clearAllSessions() {
            const results = document.getElementById('results');
            results.innerHTML = '<p>正在清除会话...</p>';
            
            try {
                // 这个操作需要后端API支持
                const response = await fetch('/api/auth/reset', {
                    method: 'POST'
                });
                
                if (response.ok) {
                    results.innerHTML = '<p class="success">✅ 会话已清除，现在可以重新登录</p>';
                } else {
                    throw new Error('API请求失败');
                }
            } catch (error) {
                results.innerHTML = `
                    <p class="error">❌ 清除失败: ${error.message}</p>
                    <p>请手动在Cloudflare Dashboard中清除KV命名空间：</p>
                    <ol>
                        <li>进入 Workers & Pages → KV</li>
                        <li>找到你的命名空间 (kb-sessions)</li>
                        <li>删除所有键值对</li>
                    </ol>
                `;
            }
        }
    </script>
</body>
</html>